# Author: Kahu
# Last Edit: Kahu. Added encode feature

import logging
import traceback
import subprocess
import os
import subprocess
import sys
import re
import time
import argparse
import GenericCommand
import string
from datetime import date, datetime
import signal

#sample command : python audio_encode_decode.py -s 172.30.249.154 -a 10.221.120.132 -t aaclc_decode
#sample command : python audio_encode_decode.py -s 172.30.249.154 -a 10.221.120.132 -t aaclc_dev_to_file
#sample command : python audio_encode_decode.py -s 172.30.249.154 -a 10.221.120.132 -t g722_decode
#sample command : python audio_encode_decode.py -s 172.30.249.154 -a 10.221.120.132 -t g722_dev_to_file --error
#sample command : python audio_encode_decode.py -s 172.30.249.154 -a 10.221.120.132 -t g726_decode
#sample command : python audio_encode_decode.py -s 172.30.249.154 -a 10.221.120.132 -t g726_dev_to_file --error
#sample command : python audio_encode_decode.py -s 172.30.249.154 -a 10.221.120.132 -t g711_decode
#sample command : python audio_encode_decode.py -s 172.30.249.154 -a 10.221.120.132 -t g711_dev_to_file
#sample command : python audio_encode_decode.py -s 172.30.249.154 -a 10.221.120.132 -t mp212_decode
#sample command : python audio_encode_decode.py -s 172.30.249.154 -a 10.221.120.132 -t mp212_dev_to_file --error
#sample command : python audio_encode_decode.py -s 172.30.249.154 -a 10.221.120.132 -t ADPCM_decode

#sample command : python audio_encode_decode.py -s 172.30.249.154 -t mp2l2_encode
#sample command : python audio_encode_decode.py -s 172.30.249.154 -t ADPCM_encode
#sample command : python audio_encode_decode.py -s 172.30.249.154 -t g711_encode
#sample command : python audio_encode_decode.py -s 172.30.249.154 -t g726_encode
#sample command : python audio_encode_decode.py -s 172.30.249.154 -t g722_encode
#sample command : python audio_encode_decode.py -s 172.30.249.154 -t aaclc_encode

#002-002,007-002,001-002,005-002,003-002,006-002
#sample command : python audio_encode_decode.py -s 172.30.249.154 -t g711_dev_to_file_encode
#sample command : python audio_encode_decode.py -s 172.30.249.154 -t mp212_dev_to_file_encode  --fail
#sample command : python audio_encode_decode.py -s 172.30.249.154 -t ADPCM_dev_to_file_encode
#sample command : python audio_encode_decode.py -s 172.30.249.154 -t g726_dev_to_file_encode --fail
#sample command : python audio_encode_decode.py -s 172.30.249.154 -t g722_dev_to_file_encode --showing pass
#sample command : python audio_encode_decode.py -s 172.30.249.154 -t aaclc_dev_to_file_encode --fail

script_name = str(sys.argv[0])
dev_1_ip = "10.221.123.93"
gcs_port = "2300" # GenericCommandServer default port is 2300
earhost_ip = "10.221.120.132" # AutoEar Windows machine IP
earhost_gcs_port = "2300"
threshold_ch0 = None
threshold_ch1 = None
threshold = 95
workingDir = "/home/siv_test_collateral/siv_val-io-test-apps/audio/"
audioFileDir = "/home/siv_test_collateral/siv_val-io-test-apps/audio/Audio_wav_files/"
logDir = "/home/siv_test_collateral/siv_val-io-test-apps/audio/Audio_log/"
rec_file_directory = "/home/siv_test_collateral/siv_val-io-test-apps/audio/Record_wav_files/"
encode_rec_Dir = "/home/siv_test_collateral/siv_val-io-test-apps/audio/Record_wav_files/Encode_wav_files/"
encode_devtofile_Dir = "/home/siv_test_collateral/siv_val-io-test-apps/audio/Record_wav_files/Encode_devtofile/"
dev_to_file_enc = "aplay -v -Dhw:0,1 -d15 "+audioFileDir+ "16b_16k_2ch.wav | gst-launch-1.0 -e alsasrc device=hw:0,1 ! "
gst_kill = " & sleep 14;kill -2 $(pgrep gst-launch-1.0)"
logFile = "Audio_" + str(datetime.now().date()) + ".log"
debug = False
verdict = False
master = "master"
capture = "capture"
resultList = []
waveFileList = []
log = "Null"

usage="This program will execute gstreamer audio tests.\n"

parser = argparse.ArgumentParser(prog = script_name, description = usage)
parser.add_argument('-s', help='SUT IP')
parser.add_argument('-t', help='testid')
parser.add_argument('-a', help='AUTOEAR IP')

args = parser.parse_args()

if args.s is not None:
    dev_1_ip = args.s
if args.a is not None:
    earhost_ip = args.a
if args.t is not None:
    testid= args.t

# Host machine configuration
host_os = "linux" # linux or windows
record_hw = "hw:0,0"
record_bit_depth = "32" # 16 or 32
record_fs = "48000"
record_ch = "2"
wait_to_kill = 30
duration = " -d " + str(wait_to_kill) + " " # seconds
sleepTime = wait_to_kill + 3
#gold_wav path
destination_file_dir = "C:\\audio_automation\Record_wav\kmb\\"
gold_sample = "C:\\audio_automation\Gold_wav_file\gold.wav"
gold_wav_base_location = "C:\\audio_automation\Gold_wav_file\gold\\"
    
def file_transfered(rec_file):
    print "Transferring: "+ rec_file_directory + rec_file
    AutoEarHost.timefiletransfer(rec_file_directory + rec_file, destination_file_dir + rec_file)
    if verdict and AutoEarHost.timefiletrace(destination_file_dir + rec_file):
        print "\n"
        message = "DEBUG: " + rec_file_directory + rec_file + " has been sent to " + earhost_ip
        
def get_current_time():
    #return time in <hour:minute:second> format"
    currentTime = datetime.time(datetime.now())
    time_Hour = currentTime.hour
    time_Minute = currentTime.minute
    time_Second = currentTime.second
    Time_now = str(time_Hour) + "_" + str(time_Minute) + "_" + str(time_Second)
    return Time_now

def get_current_date():
    #return date in YYYY-MM-DD format
    currentdate = datetime.date(datetime.now())
    date_year = currentdate.year
    date_month = currentdate.month
    date_day = currentdate.day
    date_now = str(date_year) + "-" + str(date_month) + "-" + str(date_day)
    return date_now

def write_log(filename='', line=''):
    target = open(str(filename), 'a')
    line = "[" + str(get_current_date()) + " " + str(get_current_time()) + "] \t" + str(line) + "\n"
    # Writes log in the format of: "[2015-12-02]    Comments" to the specified file
    target.write(line)
    target.close()

#flow 5
def result_parser(output,default_threshold):

    "Perform auto ear generated log result parsing"
    global dict
    global result_output
    dict = {}
    chl_list = []
    rate_list = []
    pass_list = []
    result_output = []
    date = ""
    result = True

    message = "***Extracting result from AUTOEAR server***"
    print message
    
    for line in output:
        print line
        if "Audio content size" in line:
            match_chl = re.search(r'channel \d',line)
            if match_chl:
                chl_list.append(match_chl.group(0))

        elif "Total Similarity" in line:
            match_rate = re.search(r'\d+.\d+',line)
            if match_rate:
                rate_list.append(match_rate.group(0))
    
    print "Retrieving data....."
    if not chl_list or not rate_list:
        result = False
        print "***Failed to retrieve comparison result, the Audio Comparison App might has crashed***"
        #sys.exit(1)
    else:
        print chl_list
        print rate_list

    threshold_dict = {"0":threshold_ch0,"1":threshold_ch1}

    for rate in rate_list:
        if float(rate) >= default_threshold:
            pass_list.append("PASS")
        else:
            pass_list.append("FAIL")
    
    print pass_list    
    
    if "FAIL" in pass_list:
        result = "FAIL"
    elif "PASS" in pass_list:
        result = "PASS"
    
    return result
        
def Autoear_result_check(verdict,gold_sample,rec_file):
            if verdict:
                try:
                    msg = "Auto ear is running ..."
                    print msg
                    AutoEarHost.execute("mkdir C:\\audio_automation\AudioCompare_Log")
                    auto_ear_cmd = "C:\\WinAutoEar\AudioCompare.exe compare " + str(threshold) + " " + gold_sample + " " + destination_file_dir + rec_file + " C:\\audio_automation\AudioCompare_Log\compare.log"
                    #print auto_ear_cmd
                    #AutoEarHost.timeexecute(auto_ear_cmd)
                    AutoEarHost.execute(auto_ear_cmd)
                
                    # Below is checks if AutoEar terminates automatically. Adapted from HDA script
                    counter = 0
                    timeout = 10
                    while counter <= timeout:
                        if counter >= timeout - 1:
                            task = "AudioCompare.exe"
                            checker = AutoEarHost.execute("tasklist")
                            print "DEBUG: " + checker
                            #write_log(workingDir + logFile, message)
                            if "AudioCompare.exe" in checker:
                                AutoEarHost.execute("taskkill /F /im " + task)
                                message = "DEBUG: AudioCompare terminated."
                                print message
                                write_log(logDir + logFile, message)
                                break
                            else:
                                pass
                        time.sleep(1)
                        counter = counter + 1
                        
                    verdict = True

                except Exception, error:
                    type_, value_, traceback_ = sys.exc_info()
                    message = str(error)
                    print message
                    write_log(logDir + logFile, message)
                    message = traceback.format_tb(traceback_)
                    print message
                    write_log(logDir + logFile, message)
                    message = "ERROR: AutoEar failed to execute!"
                    verdict = False
					
			#flow 6
            ## Parse AutoEar result & final verdict
            if verdict:
                output = AutoEarHost.execute("type C:\\audio_automation\AudioCompare_Log\compare.log")
                output_list = output.split("\n")
                #for line in output_list:
                    #print line
                result = result_parser(output_list,threshold) # call function flow 5
                print "Final Result = " + str(result)
                
                for i in output_list:
                    if "compared" in i:
                        length = i.split(" ")[-1]
                        length = length[:-1]
                message = "DEBUG: Comparable length: " + str(length) + " sec"
                print message
                write_log(logDir + logFile, message)
                
                length = str(length)
                if len(length) > 1:
                    length = float(length)
                else:
                    length = int(length)
                
                print "results = " + str(result)
                print "length = " + str(length)
                print "logFile: " + logDir + logFile
                
                AutoEarHost.execute("DEL C:\\audio_automation\Record_wav\kmb\*.wav*.fft")
                AutoEarHost.execute("DEL C:\\audio_automation\Gold_wav_file\gold\*.wav*.fft")
                cmd = "RENAME C:\\audio_automation\AudioCompare_Log\compare.log compare_" + "%date:~10,4%%date:~7,2%%date:~4,2%_%time:~0,2%%time:~3,2%" + "_volume_" + master + "_capture_" + capture + "_" + result + ".log"

                AutoEarHost.execute(cmd)
            
            else:
                message = "ERROR: AutoEar Result parsing error"
                print message
                write_log(logDir + logFile, message)
                verdict = False
                
            if verdict:
                message = "DEBUG: " + script_name + " has completed successfully.\n"
                print message
                write_log(logDir + logFile, message)
                print "....Audio execution completed"
			
            else:
                message = "ERROR: " + script_name + " has encountered an error during execution.\n"
                print message
                write_log(logDir + logFile, message)
                print ".....execution not completed"
                
            message = "\nDEBUG: " + script_name + " has completed trial run.\n" 

def Start_GenericCommandServer():
    command = os.popen('ps ax').read()
    #print "command:"+command
    read_list = re.compile("\n").split(command)
    generic = True
    for line in read_list:
        if re.search("GenericCommandServer",line):          
            print "GenericCommandServer is Already Running"
            generic = False
            break
    if generic:
        subprocess.Popen(["python",workingDir+"GenericCommandServer.py"])
        subprocess.call(["echo","genericcommandserver is started"])
    else:
        print "done"
 
Start_GenericCommandServer();  
dut = GenericCommand.GenericCommand()
dut.login(dev_1_ip,gcs_port)
AutoEarHost = GenericCommand.GenericCommand()
AutoEarHost.login(earhost_ip, earhost_gcs_port)

def main():
    dut.execute("echo 'here execute alsamixer commands'")
    if testid == "aaclc_decode":
        rec_file = "aaclc_dec"+get_current_date()+get_current_time()+".wav"
        dut.execute("gst-launch-1.0 filesrc location="+audioFileDir+"aaclc_enc.mp4 ! qtdemux ! aacparse ! avdec_aac ! audioconvert ! audio/x-raw,format=S16LE, channels=2 ! wavenc ! filesink location ="+rec_file_directory+rec_file)
        os.system("scp root@"+dev_1_ip+":"+rec_file_directory+rec_file+" "+rec_file_directory)
        gold_sample = gold_wav_base_location + "aaclc_dec.wav"
    elif testid == "aaclc_dev_to_file":
        rec_file = "aaclc_dec_dev"+get_current_date()+get_current_time()+".wav"
        dut.execute("gst-launch-1.0 filesrc location="+audioFileDir+"aaclc_enc.mp4 ! qtdemux ! aacparse ! avdec_aac ! audioconvert ! audio/x-raw,channels=2,rate=16000,format=S16LE ! alsasink device=hw:0,1 |  arecord -Dhw:0,1 -fS16_LE -c2 -r16000 -d10 "+rec_file_directory+rec_file)
        os.system("scp root@"+dev_1_ip+":"+rec_file_directory+rec_file+" "+rec_file_directory)
        gold_sample = gold_wav_base_location + "aaclc_dec_dev.wav"
    elif testid == "g726_decode":
        rec_file = "g726_dec"+get_current_date()+get_current_time()+".wav"
        dut.execute("gst-launch-1.0 filesrc location="+audioFileDir+"g726_enc.mka ! matroskademux ! avdec_g726 ! wavenc ! filesink location="+rec_file_directory+rec_file)
        os.system("scp root@"+dev_1_ip+":"+rec_file_directory+rec_file+" "+rec_file_directory)
        gold_sample = gold_wav_base_location + "g726_dec.wav"
    #elif testid == "g726_dev_to_file_decode":
        #rec_file = "g726_dec_dev"+get_current_date()+get_current_time()+".wav"
        #dut.execute("gst-launch-1.0 filesrc location="+audioFileDir+"g726_enc.mka ! matroskademux ! avdec_g726 ! audio/x-raw, rate=8000, channel=1, format=S16LE ! alsasink device=hw:0,1 | arecord -Dhw:0,1 -fS16_LE -c2 -r16000 -d10 "+rec_file_directory+rec_file)
        #os.system("scp root@"+dev_1_ip+":"+rec_file_directory+rec_file+" "+rec_file_directory)
        #gold_sample = gold_wav_base_location + "g726_dec_dev.wav"
    elif testid == "g726_dev_to_file_decode":
        rec_file = "G726_Decoded"+get_current_date()+get_current_time()+".wav"
        dut.execute("gst-launch-1.0 filesrc location="+audioFileDir+"G726_Encoded_0.8.mka ! matroskademux ! avdec_g726 ! audioconvert ! audioresample ! audio/x-raw,channels=2,rate=16000,format=S16LE ! alsasink device=hw:0,1 | arecord -c2 -r16000 -fS16_LE "+rec_file_directory+rec_file+ "-Dhw:0,1")
        os.system("scp root@"+dev_1_ip+":"+rec_file_directory+rec_file+" "+rec_file_directory)
        gold_sample = gold_wav_base_location + "G726_Decoded.wav"
    elif testid == "g722_dev_to_file_decode":
        rec_file = "G722_Decoded"+get_current_date()+get_current_time()+".wav"
        dut.execute("gst-launch-1.0 filesrc location="+audioFileDir+"G722_Encoded.mka ! matroskademux ! avdec_g722 ! audioconvert ! audioresample ! audio/x-raw,channels=2,rate=16000,format=S16LE ! alsasink device=hw:0,1 | arecord -c2 -r16000 -fS16_LE "+rec_file_directory+rec_file+ "-Dhw:0,1")
        os.system("scp root@"+dev_1_ip+":"+rec_file_directory+rec_file+" "+rec_file_directory)
        gold_sample = gold_wav_base_location + "G722_Decoded.wav"     
    elif testid == "g722_decode":
        rec_file = "g722_dec"+get_current_date()+get_current_time()+".wav"
        dut.execute("gst-launch-1.0 filesrc location="+audioFileDir+"g722_enc.mka ! matroskademux ! avdec_g722 ! wavenc ! filesink location="+rec_file_directory+rec_file)
        os.system("scp root@"+dev_1_ip+":"+rec_file_directory+rec_file+" "+rec_file_directory)
        gold_sample = gold_wav_base_location + "g722_dec.wav"
    elif testid == "g722_dev_t  o_file_decode":
        rec_file = "g722_dec_dev"+get_current_date()+get_current_time()+".wav"
        dut.execute("gst-launch-1.0 filesrc location="+audioFileDir+"g722_enc.mka ! matroskademux ! avdec_g722 ! audio/x-raw, rate=16000 ! alsasink device=hw:0,1 | arecord -Dhw:0,1 -fS16_LE -c2 -r16000 -d10 "+rec_file_directory+rec_file)
        os.system("scp root@"+dev_1_ip+":"+rec_file_directory+rec_file+" "+rec_file_directory)
        gold_sample = gold_wav_base_location + "g722_dec_dev.wav"
    elif testid == "g711_decode":
        rec_file = "g711_dec"+get_current_date()+get_current_time()+".wav"
        dut.execute("gst-launch-1.0 filesrc location="+audioFileDir+"g711_enc.mov ! qtdemux ! alawdec ! wavenc ! filesink location="+rec_file_directory+rec_file)
        os.system("scp root@"+dev_1_ip+":"+rec_file_directory+rec_file+" "+rec_file_directory)
        gold_sample = gold_wav_base_location + "g711_dec.wav"
    elif testid == "g711_dev_to_file":
        rec_file = "g711_dec_dev"+get_current_date()+get_current_time()+".wav"
        dut.execute("gst-launch-1.0 filesrc location="+audioFileDir+"g711_enc.mov ! qtdemux ! alawdec ! audioconvert ! audio/x-raw,channels=2,rate=16000,format=S16LE ! alsasink device=hw:0,1 |  arecord -Dhw:0,1 -fS16_LE -c2 -r16000 -d10 "+rec_file_directory+rec_file)
        os.system("scp root@"+dev_1_ip+":"+rec_file_directory+rec_file+" "+rec_file_directory)
        gold_sample = gold_wav_base_location + "g711_dec_dev.wav"
    elif testid == "mp212_decode":
        rec_file = "mp2l2_dec"+get_current_date()+get_current_time()+".wav"
        dut.execute("gst-launch-1.0 filesrc location="+audioFileDir+"mp2l2_enc.avi ! avidemux ! avdec_mp2float ! audioconvert ! audio/x-raw,format=S16LE,channels=2 ! wavenc ! filesink location="+rec_file_directory+rec_file)
        os.system("scp root@"+dev_1_ip+":"+rec_file_directory+rec_file+" "+rec_file_directory)
        gold_sample = gold_wav_base_location + "mp2l2_dec.wav"
    elif testid == "mp212_dev_to_file_decode":
        rec_file = "mp2l2_dec_dev"+get_current_date()+get_current_time()+".wav"
        dut.execute("gst-launch-1.0 filesrc location="+audioFileDir+"mp2l2_enc.avi ! avidemux ! avdec_mp2float ! audioconvert ! audio/x-raw,format=S16LE,channels=2 ! alsasink device=hw:0,1 | arecord -Dhw:0,1 -fS16_LE -c2 -r16000 -d10 "+rec_file_directory+rec_file)                
        gold_sample = gold_wav_base_location + "mp2l2_dec.wav"
    elif testid == "ADPCM_decode":
        rec_file = "adpcm_dec"+get_current_date()+get_current_time()+".wav"
        dut.execute("gst-launch-1.0 filesrc location="+audioFileDir+"adpcm_enc.mka ! matroskademux ! adpcmdec ! audioconvert ! audio/x-raw,format=S16LE, channels=2 ! wavenc ! filesink location ="+rec_file_directory+rec_file)
        os.system("scp root@"+dev_1_ip+":"+rec_file_directory+rec_file+" "+rec_file_directory)
        gold_sample = gold_wav_base_location + "adpcm_dec.wav"
    elif testid == "16b_48k_2ch":
        rec_file = "16b_48k_2ch"+get_current_date()+get_current_time()+".wav"
        dut.execute("aplay -Dhw:0,1 -d10 "+audioFileDir+"16b_48k_2ch.wav & arecord -Dhw:0,1 -fS16_LE -c2 -r48000 -d10 "+rec_file_directory+rec_file)
        os.system("scp root@"+dev_1_ip+":"+rec_file_directory+rec_file+" "+rec_file_directory)
        gold_sample = gold_wav_base_location + "16b_48k_2ch.wav"
    elif testid == "ADPCM_encode":
        dut.execute("gst-launch-1.0 filesrc location="+audioFileDir+"16k_2ch_16bits.wav ! wavparse ! audioconvert ! adpcmenc ! matroskamux ! filesink location="+encode_rec_Dir+"adpcm_enc.mka")
        rec_file = "adpcm_dec"+get_current_date()+get_current_time()+".wav"
        dut.execute("gst-launch-1.0 filesrc location="+encode_rec_Dir+"adpcm_enc.mka ! matroskademux ! adpcmdec ! audioconvert ! audio/x-raw,format=S16LE, channels=2 ! wavenc ! filesink location ="+rec_file_directory+rec_file)
        os.system("scp root@"+dev_1_ip+":"+rec_file_directory+rec_file+" "+rec_file_directory)
        gold_sample = gold_wav_base_location + "adpcm_dec.wav"
    elif testid == "g711_encode":
        dut.execute("gst-launch-1.0 filesrc location="+audioFileDir+"16k_2ch_16bits.wav ! wavparse ! audioconvert ! audioresample ! alawenc ! qtmux ! filesink location="+encode_rec_Dir+"g711_enc.mov")
        rec_file = "g711_dec"+get_current_date()+get_current_time()+".wav"
        dut.execute("gst-launch-1.0 filesrc location="+encode_rec_Dir+"g711_enc.mov ! qtdemux ! alawdec ! wavenc ! filesink location="+rec_file_directory+rec_file)
        os.system("scp root@"+dev_1_ip+":"+rec_file_directory+rec_file+" "+rec_file_directory)
        gold_sample = gold_wav_base_location + "g711_dec.wav"        
    elif testid == "g726_encode":
        #dut.execute("gst-launch-1.0 filesrc location="+audioFileDir+"16k_2ch_16bits.wav ! wavparse ! audioconvert ! audioresample ! audio/x-raw, rate=8000, channel=1, format=S16LE ! avenc_g726 ! matroskamux ! filesink location="+encode_rec_Dir+"g726_enc.mka")
        dut.execute("aplay -v -Dhw:0,1 -d10 "+audioFileDir+"16khz_16bit_2ch_0.8amp.wav | gst-launch-1.0 -e alsasrc device=hw:0,1 ! audio/x-raw,channels=2,rate=16000,format=S16LE ! audioconvert ! audioresample ! audio/x-raw, rate=8000, channel=1, format=S16LE ! avenc_g726 ! matroskamux ! filesink location="+encode_rec_Dir+"g726_enc.mka")
        rec_file = "g726_dec"+get_current_date()+get_current_time()+".wav"
        dut.execute("gst-launch-1.0 filesrc location="+encode_rec_Dir+"g726_enc.mka ! matroskademux ! avdec_g726 ! wavenc ! filesink location="+rec_file_directory+rec_file)
        #dut.execute("gst-launch-1.0 filesrc location="/home/siv_test_collateral/siv_val-io-test-apps/audio/Record_wav_files/Encode_wav_files/"g726_enc.mka ! matroskademux ! avdec_g726 ! wavenc ! filesink location="/home/siv_test_collateral/siv_val-io-test-apps/audio/Record_wav_files/"rec_file")
        #dut.execute("gst-launch-1.0 filesrc location="/home/siv_test_collateral/siv_val-io-test-apps/audio/Record_wav_files/Encode_wav_files/"g726_enc.mka ! matroskademux ! avdec_g726 ! wavenc ! filesink location="/home/siv_test_collateral/siv_val-io-test-apps/audio/Record_wav_files/"rec_file")
        os.system("scp root@"+dev_1_ip+":"+rec_file_directory+rec_file+" "+rec_file_directory)
        gold_sample = gold_wav_base_location + "g726_dec.wav"
    elif testid == "g722_encode":
        dut.execute("gst-launch-1.0 filesrc location="+audioFileDir+"16k_2ch_16bits.wav ! wavparse ! audioconvert ! audio/x-raw, rate=16000, channel=1 ! avenc_g722 ! matroskamux ! filesink location="+encode_rec_Dir+"g722_enc.mka")
        rec_file = "g722_dec"+get_current_date()+get_current_time()+".wav"
        dut.execute("gst-launch-1.0 filesrc location="+encode_rec_Dir+"g722_enc.mka ! matroskademux ! avdec_g722 ! wavenc ! filesink location="+rec_file_directory+rec_file)
        os.system("scp root@"+dev_1_ip+":"+rec_file_directory+rec_file+" "+rec_file_directory)
        gold_sample = gold_wav_base_location + "g722_dec.wav"
    elif testid == "aaclc_encode":
        dut.execute("gst-launch-1.0 filesrc location="+audioFileDir+"16k_2ch_16bits.wav ! wavparse ! audioconvert ! avenc_aac ! mp4mux ! filesink location="+encode_rec_Dir+"aaclc_enc.mp4")
        rec_file = "aaclc_dec"+get_current_date()+get_current_time()+".wav"
        dut.execute("gst-launch-1.0 filesrc location="+encode_rec_Dir+"aaclc_enc.mp4 ! qtdemux ! aacparse ! avdec_aac ! audioconvert ! audio/x-raw,format=S16LE, channels=2 ! wavenc ! filesink location ="+rec_file_directory+rec_file)
        os.system("scp root@"+dev_1_ip+":"+rec_file_directory+rec_file+" "+rec_file_directory)
        gold_sample = gold_wav_base_location + "aaclc_dec.wav"
    elif testid == "mp2l2_encode":
        dut.execute("gst-launch-1.0 filesrc location="+audioFileDir+"16k_2ch_16bits.wav ! wavparse ! avenc_mp2 ! avimux ! filesink location="+encode_rec_Dir+"mp2l2_enc.avi")
        rec_file = "mp2l2_dec"+get_current_date()+get_current_time()+".wav"
        dut.execute("gst-launch-1.0 filesrc location="+encode_rec_Dir+"mp2l2_enc.avi ! avidemux ! avdec_mp2float ! audioconvert ! audio/x-raw,format=S16LE,channels=2 ! wavenc ! filesink location="+rec_file_directory+rec_file)
        os.system("scp root@"+dev_1_ip+":"+rec_file_directory+rec_file+" "+rec_file_directory)
        gold_sample = gold_wav_base_location + "mp2l2_dec.wav"
    elif testid == "g711_dev_to_file_encode":
        dut.execute(dev_to_file_enc + "audio/x-raw,format=S16LE,channels=2,rate=16000 ! audioconvert ! audioresample ! audio/x-raw,channels=2,rate=16000,format=S16LE ! alawenc ! qtmux ! filesink location="+encode_devtofile_Dir+"g711_enc.mov"+gst_kill)
        rec_file = "g711_dec"+get_current_date()+get_current_time()+".wav"
        dut.execute("gst-launch-1.0 filesrc location="+encode_devtofile_Dir+"g711_enc.mov ! qtdemux ! alawdec ! wavenc ! filesink location="+rec_file_directory+rec_file)
        os.system("scp root@"+dev_1_ip+":"+rec_file_directory+rec_file+" "+rec_file_directory)
        gold_sample = gold_wav_base_location + "g711_dec.wav" 
    elif testid == "mp212_dev_to_file_encode":
        dut.execute(dev_to_file_enc + "avenc_mp2 ! avimux ! filesink location="+encode_devtofile_Dir+"mp2l2_enc.avi"+gst_kill)
        rec_file = "mp2l2_dec_dev"+get_current_date()+get_current_time()+".wav"
        dut.execute("gst-launch-1.0 filesrc location="+encode_devtofile_Dir+"mp2l2_enc.avi ! avidemux ! avdec_mp2float ! audioconvert ! audio/x-raw,format=S16LE,channels=2 ! alsasink device=hw:0,1 | arecord -Dhw:0,1 -fS16_LE -c2 -r16000 -d10 "+rec_file_directory+rec_file)                
        os.system("scp root@"+dev_1_ip+":"+rec_file_directory+rec_file+" "+rec_file_directory)
        gold_sample = gold_wav_base_location + "mp2l2_dec.wav"
    elif testid == "ADPCM_dev_to_file_encode": 
        dut.execute(dev_to_file_enc + "audio/x-raw,channels=2,rate=16000,format=S16LE ! audioconvert ! adpcmenc ! matroskamux ! filesink location="+encode_devtofile_Dir+"adpcm_enc.mka"+gst_kill)
        rec_file = "adpcm_dec"+get_current_date()+get_current_time()+".wav"
        dut.execute("gst-launch-1.0 filesrc location="+encode_devtofile_Dir+"adpcm_enc.mka ! matroskademux ! adpcmdec ! audioconvert ! audio/x-raw,format=S16LE, channels=2 ! wavenc ! filesink location ="+rec_file_directory+rec_file)
        os.system("scp root@"+dev_1_ip+":"+rec_file_directory+rec_file+" "+rec_file_directory)
        os.system("scp root@"+dev_1_ip+":"+rec_file_directory+rec_file+" "+rec_file_directory)
        gold_sample = gold_wav_base_location + "adpcm_dec.wav"
    elif testid == "g726_dev_to_file_encode": 
        dut.execute(dev_to_file_enc + "audio/x-raw,format=S16LE,rate=8000,channel=1 ! audioconvert ! audioresample ! avenc_g726 ! matroskamux ! filesink location="+encode_devtofile_Dir+"g726_enc.mka"+gst_kill)
        rec_file = "g726_dec"+get_current_date()+get_current_time()+".wav"
        dut.execute("gst-launch-1.0 filesrc location="+encode_devtofile_Dir+"g726_enc.mka ! matroskademux ! avdec_g726 ! wavenc ! filesink location="+rec_file_directory+rec_file)
        os.system("scp root@"+dev_1_ip+":"+rec_file_directory+rec_file+" "+rec_file_directory)
        gold_sample = gold_wav_base_location + "g726_dec.wav"
    elif testid == "g722_dev_to_file_encode":  
        dut.execute(dev_to_file_enc + "audio/x-raw,rate=16000 ! audioconvert ! avenc_g722 ! matroskamux ! filesink location="+encode_devtofile_Dir+"g722_enc.mka"+gst_kill)
        rec_file = "g722_dec"+get_current_date()+get_current_time()+".wav"
        dut.execute("gst-launch-1.0 filesrc location="+encode_devtofile_Dir+"g722_enc.mka ! matroskademux ! avdec_g722 ! wavenc ! filesink location="+rec_file_directory+rec_file)
        os.system("scp root@"+dev_1_ip+":"+rec_file_directory+rec_file+" "+rec_file_directory)
        gold_sample = gold_wav_base_location + "g722_dec.wav"
    elif testid == "aaclc_dev_to_file_encode": 
        dut.execute(dev_to_file_enc + "audio/x-raw,channels=2,rate=16000,format=S16LE ! audioconvert ! avenc_aac ! mp4mux ! filesink location="+encode_devtofile_Dir+"aaclc_enc.mp4"+gst_kill)
        rec_file = "aaclc_dec"+get_current_date()+get_current_time()+".wav"
        dut.execute("gst-launch-1.0 filesrc location="+encode_devtofile_Dir+"aaclc_enc.mp4 ! qtdemux ! aacparse ! avdec_aac ! audioconvert ! audio/x-raw,format=S16LE, channels=2 ! wavenc ! filesink location ="+rec_file_directory+rec_file)
        os.system("scp root@"+dev_1_ip+":"+rec_file_directory+rec_file+" "+rec_file_directory)
        gold_sample = gold_wav_base_location + "aaclc_dec.wav"
    else:
        dut.execute("echo 'no test case' ")
        sys.exit(1)
    print "Test done...."
    file_transfered(rec_file)
    Autoear_result_check(True,gold_sample,rec_file)

if __name__ == "__main__":
    main()
    
## EOF
